<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!--<template id="solse_pe_cpe_guias.cpe_guia_plantilla_n1">-->

    <template id="l10n_pe_edi_guia_remision_remitente_sunat">
        <!--<t t-call="web.external_layout">-->
        
            <t t-set="doc" t-value="doc.with_context(lang=doc.partner_id.lang)"/>

            <t t-if="not company">
                <!-- Multicompany -->
                <t t-if="company_id">
                    <t t-set="company" t-value="company_id"/>
                </t>
                <t t-elif="o and 'company_id' in o">
                    <t t-set="company" t-value="o.company_id.sudo()"/>
                </t>
                <t t-else="else">
                    <t t-set="company" t-value="res_company"/>
                </t>
            </t>

            <!-- Header 
            <div class="header o_company_#{company.id}_layout factura" t-att-style="report_header_style">-->
            <div class="header o_company_#{company.id}_layout factura" style="font-family: Monaco; font-size: 13px;">
                <div class="row">
                    <div class="col-3 col-xs-4 mt32">
                        <div style="text-align:center;">
                            <img t-if="company.logo" t-att-src="image_data_uri(company.logo)" style="max-height: 90px; height: 90px; max-width: 150px; display:block; margin-left: auto; margin-right: auto; top: 30%;" alt="Logo"/>
                        </div>
                    </div>
                    <div class="col-4 empresa" name="company_address">
                        <strong><span t-field="company.name"/></strong>
                        <br/>
                        <span t-field="company.street"/>
                        -
                        <span t-field="company.partner_id.l10n_pe_district.name"/>-
                        <span t-field="company.state_id.name"/>-
                        <span t-field="company.city"/>
                        
                        <span t-if="company.phone">
                            Telf.:<span t-field="company.phone"/>
                        </span>
                    </div>
                    <div class="col-6 text-right" >
                        <div class="nro-cpe">

                            <!--<div style="border: 1px solid #ddd !important; border-radius: 6px; margin: auto; padding-top: 18px;">-->

                            <div style="margin: auto; padding-top: 18px;">
                                
                                <strong>RUC: <span t-field="company.vat"/></strong>
                                <br/>
                                
                                <span>
                                    <strong>GUÍA DE REMISIÓN ELECTRÓNICA</strong>
                                    <br/>
                                </span>

                                <strong><span t-field="doc.l10n_latam_document_number"/></strong>
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>

            <!-- Body -->
            <div class="article o_report_layout_clean factura" t-att-data-oe-model="doc and doc._name" t-att-data-oe-id="doc and doc.id" style="font-family: Monaco; font-size: 13px;">
             
                <!--<t t-set="o" t-value="o.with_context(lang=lang)" />-->
                <div class="factura">
                	<div class="text-center" style="width: 100%;">
                        <div class="row">
                            
                            <div class="col-4">
                                <div style="border: 1px solid #ddd !important; border-radius: 6px; width: 100%;">
                                    <div style="margin-left: 15px; text-align: left;">
                                        Fecha de Emisión: 
                                    </div>
                                    <div style="margin-left: 15px; text-align: left;">
                                        <span t-esc="str(doc.date_done).split(' ')[0]"/>
                                    </div>
                                </div>
                            </div>

                            <div class="col-4">
                                <div style="border: 1px solid #ddd !important; border-radius: 6px; width: 100%; margin: 0 auto;">
                                    <div style="margin-left: 15px; text-align: left;">
                                        Fecha de Inicio de traslado: 
                                    </div>

                                    <div style="margin-left: 15px; text-align: left;">
                                        <span t-esc="str(doc.l10n_pe_edi_departure_start_date).split(' ')[0]"/>
                                    </div>
                                </div>
                            </div>
                            <div class="col-4">
                                
                            </div>
                        </div>
                    </div>

                    <br></br>

                    <div class="col-12" style="border: 1px solid #ddd !important; border-radius: 6px; width: 100%; ">

                    	<div style="width: 100%; text-align: left;">
                    		<strong style="margin-left: 15px;">PUNTO DE PARTIDA</strong>
                    	</div>

                        <t t-set="punto_partida" t-value="company.partner_id"/>

                        <t t-if="doc.picking_type_id.code == 'internal' and doc.almacen_origen">
                            <t t-set="punto_partida" t-value="doc.almacen_origen.partner_id"  />
                        </t>

                        <div style="width: 100%; text-align: left; margin-left: 15px;">
                            <span t-field="punto_partida.street"/> - 
                            <span t-field="punto_partida.l10n_pe_district.name"/>,
                            <span t-field="punto_partida.state_id.name"/>,
                            <span t-field="punto_partida.city_id.name"/>,
                            <span t-field="punto_partida.country_id.name"/>
                        </div>

                    </div>
                    <br></br>


                    <div class="col-12" style="border: 1px solid #ddd !important; border-radius: 6px; width: 100%; margin: 0 auto;">

                    	<div style="width: 100%; text-align: left;">
                    		<strong style="margin-left: 15px;">PUNTO DE LLEGADA</strong>
                    	</div>

                        <t t-set="punto_llegada" t-value="doc.partner_id"/>

                        <t t-if="doc.picking_type_id.code == 'internal' and doc.almacen_destino">
                            <t t-set="punto_llegada" t-value="doc.almacen_destino.partner_id"  />
                        </t>

                        <div style="width: 100%; text-align: left;">
                            <t style="margin-left: 15px;"><span style="margin-left: 15px;" t-esc="doc.get_street(punto_llegada)"/> - <span t-esc="doc.get_address_details(punto_llegada)"/></t>
                        </div>

                    </div>

                    <br></br>

                    <div class="text-center" style="width: 100%;" >
                    	<div class="row">
                            <div class="col-6">
                                <div style="border: 1px solid #ddd !important; border-radius: 6px; ">
                                    <div style="width: 100%; text-align: left;">
                                		<strong style="margin-left: 15px;"> DESTINATARIO</strong>
                                	</div>
                                    <div style="text-align: left; overflow-wrap: break-word;"> 
                                        <span style="margin-left: 12px;" t-field="doc.partner_id.name"/>
                                    </div>
                                    
                                    <div style="text-align: left;overflow-wrap: break-word;"> 
                                        <br></br>
                                    </div>
                                    <div style="text-align: left;overflow-wrap: break-word;"> 
                                        <strong style="margin-left: 15px;"> RUC:</strong><span t-field="doc.partner_id.vat" style="overflow-wrap: break-word;" />
                                    </div>

                                </div>
                            </div>
                            <div class="col-6">

                                <div style="border: 1px solid #ddd !important; border-radius: 6px; ">

                                    <div style="width: 100%; text-align: left;">
                                        <strong style="margin-left: 15px;"> CARGA</strong>
                                    </div>

                                    <div style="text-align: left;overflow-wrap: break-word;"> 
                                        <strong style="margin-left: 15px;"> Peso bruto:</strong><span t-field="doc.weight" style="overflow-wrap: break-word;" />
                                    </div>

                                    <div style="text-align: left;overflow-wrap: break-word;"> 
                                        <strong style="margin-left: 15px;"> Cantidad Bultos:</strong><span t-field="doc.pe_unit_quantity" style="overflow-wrap: break-word;" />
                                    </div>

                                </div>
                            </div>
                    	</div>
                    </div>
                    <br/>
                    <div style="border: 2px solid #ddd !important; border-radius: 6px; width: 100%; margin: 0;" class="defaulttable cpe-tabla">

                        <div class="row">
                            <div style="width: 55%; margin-left: 12px;"><strong>DESCRIPCION</strong></div>
                            <div style="width: 15%;"><strong>CANTIDAD</strong></div>
                            <div style="width: 15%;"><strong>MEDIDA</strong></div>
                            <div style="width: 15%;"><strong>CODIGO</strong></div>
                            
                        </div>
                        
                        <t t-set="lines" t-value="doc.move_ids.filtered(lambda x: x.product_uom_qty)"/>
                        <t t-foreach="lines" t-as="move">
                            <br/>
                            <div class="row">
                                <div style="width: 55%; margin-left: 12px;">
                                    <span t-field="move.product_id.name"/>
                                    <p t-if="move.description_picking != move.product_id.name">
                                        <span t-field="move.description_picking"/>
                                    </p>
                                </div>

                                <div style="width: 15%;">
                                    <span t-field="move.product_uom_qty"/>
                                </div>
                                <div style="width: 15%;">
                                    <span t-field="move.product_uom.name"/>
                                </div>
                                <div style="width: 15%;">
                                    <span t-field="move.product_id.product_tmpl_id.default_code"/>
                                </div>
                                
                            </div>
                        </t>
                    </div>

                    <br/>

                    <!-- ################################################################### -->

                    <div class="text-center" style="width: 100%;" >

                        <div class="row">
                            <div class="col-6">

                                <div style="border: 1px solid #ddd !important; border-radius: 6px; ">

                                    <div style="text-align: left;">
                                        <strong style="margin-left: 15px;"> MOTIVO DEL TRASLADO</strong>
                                    </div>

                                    <div style="text-align: left;overflow-wrap: break-word;"> 
                                        <span t-field="doc.l10n_pe_edi_reason_for_transfer" style="margin-left: 15px; overflow-wrap: break-word;" />
                                    </div>

                                    <div style="text-align: left;overflow-wrap: break-word;"> 
                                        <br></br>
                                    </div>

                                </div>

                                <!-- ####### TIPO DE TRANSPORTE ####### -->
                                <div style="border: 1px solid #ddd !important; border-radius: 6px; ">

                                    <div style="text-align: left;">
                                        <strong style="margin-left: 15px;"> TIPO DE TRASPORTE</strong>
                                    </div>

                                    <div style="text-align: left;overflow-wrap: break-word;"> 
                                        <span t-field="doc.l10n_pe_edi_transport_type" style="margin-left: 15px; overflow-wrap: break-word;" />
                                    </div>

                                    <div style="text-align: left;overflow-wrap: break-word;"> 
                                        <br></br>
                                    </div>

                                </div>
                                <!-- ################################## -->

                            </div>

                            <div class="col-6">
                                <t t-if="doc.l10n_pe_edi_transport_type == '01'">
                                    
                                    <div style="border: 1px solid #ddd !important; border-radius: 6px; ">
                                        <div style="text-align: center;">
                                            <strong>TRANSPORTISTA</strong>
                                        </div>
                                        
                                        <div style="text-align: left;overflow-wrap: break-word;"> 
                                            <strong style="margin-left: 15px;"> Nombre:</strong><span t-field="doc.l10n_pe_edi_operator_id.name" style="overflow-wrap: break-word;" />
                                        </div>


                                        <div style="text-align: left;overflow-wrap: break-word;"> 
                                            <strong style="margin-left: 15px;"> Nro doc.:</strong><span t-field="doc.l10n_pe_edi_operator_id.vat" t-if="doc.l10n_pe_edi_operator_id.vat" style="overflow-wrap: break-word;"/>
                                        </div>

                                        <div style="text-align: left;overflow-wrap: break-word;"> 
                                            <strong style="margin-left: 15px;"> Licencia:</strong><span t-field="doc.l10n_pe_edi_vehicle_id.license_plate" t-if="doc.l10n_pe_edi_vehicle_id.license_plate" style="overflow-wrap: break-word;"/>
                                        </div>

                                        <div style="text-align: left;overflow-wrap: break-word;"> 
                                            <br></br>
                                        </div>
               
                                    </div>
                                </t>
                                <t t-else="else">
                                    
                                    <div style="border: 1px solid #ddd !important; border-radius: 6px; ">
                                        
                                        <div style="text-align: center;">
                                            <strong>UNIDAD DE TRANSPORTE / CONDUCTOR</strong>
                                        </div>

                                        <t t-set="ingreso" t-value="0"/>

                                        <t t-if="doc.l10n_pe_edi_transport_type=='02'">

                                            <t t-set="ingreso" t-value="1"/>

                                            <div style="text-align: left;overflow-wrap: break-word;"> 
                                                <strong style="margin-left: 12px;"> VEHICULO MARCA Y PLACA Nº: </strong>
                                                    
                                                <span t-field="doc.l10n_pe_edi_vehicle_id.name" style="overflow-wrap: break-word;" /> - 
                                                <span t-field="doc.l10n_pe_edi_vehicle_id.license_plate" style="overflow-wrap: break-word;" />
                                            </div>


                                            <div style="text-align: left;overflow-wrap: break-word;"> 
                                                <strong style="margin-left: 12px;"> CERTIFICADO DE INSCRIPCIÓN Nº: </strong><span t-field="doc.l10n_pe_edi_vehicle_id.authorization_issuing_entity_number"/>
                                            </div>

                                            <div style="text-align: left;overflow-wrap: break-word;"> 
                                                <strong style="margin-left: 12px;"> LICENCIA DE CONDUCIR Nº: </strong><span t-field="doc.l10n_pe_edi_operator_id.l10n_pe_edi_operator_license"/>
                                            </div>

                                            <div style="text-align: left;overflow-wrap: break-word;"> 
                                                <strong style="margin-left: 15px;"> NOMBRE:</strong><span t-field="doc.l10n_pe_edi_operator_id.name" style="overflow-wrap: break-word;" />
                                            </div>

                                            <div style="text-align: left;overflow-wrap: break-word;"> 
                                                <strong style="margin-left: 15px;"> TIPO DOC:</strong><span t-field="doc.l10n_pe_edi_operator_id.l10n_latam_identification_type_id.l10n_pe_vat_code" style="overflow-wrap: break-word;" />
                                            </div>

                                            <div style="text-align: left;overflow-wrap: break-word;"> 
                                                <strong style="margin-left: 15px;"> NRO DOC:</strong><span t-field="doc.l10n_pe_edi_operator_id.vat" style="overflow-wrap: break-word;" />
                                            </div>

                                        </t>


                                        <t t-if="ingreso == 0">
                                            <div style="text-align: left;overflow-wrap: break-word;"> 
                                                <br></br>
                                            </div>
                                            <div style="text-align: left;overflow-wrap: break-word;"> 
                                                <br></br>
                                            </div>
                                            <div style="text-align: left;overflow-wrap: break-word;"> 
                                                <br></br>
                                            </div>
                                        </t>

                                    </div>
                                </t>
                            </div>
                        </div>
                    </div>

                    <!-- ############################################################ -->
                    
                    <br/>
                    <div t-if="doc.signature" class="mt32 ml64 mr4" name="signature">
                        <div class="offset-8">
                            <strong>Firma</strong>
                        </div>
                        <div class="offset-8">
                            <img t-att-src="image_data_uri(doc.signature)" style="max-height: 4cm; max-width: 8cm;"/>
                        </div>
                        <div class="offset-8 text-center">
                            <p t-field="doc.partner_id.name"/>
                        </div>
                    </div>

                    <div class="row" t-if="doc.l10n_latam_document_number!='/'" >
                        <div class="col-4" >


                            <!--<p t-if="doc.note" name="note">
                                <span t-field="doc.note"/>
                            </p>-->

                            <div class="row mt-3" id='pe_notes' t-if="doc.l10n_pe_edi_observation">
                                <div class="col-12">
                                    <div class="text-center">
                                        <strong t-if="doc.l10n_pe_edi_observation">Notes: </strong> <span t-out="doc.l10n_pe_edi_observation" t-if="doc.l10n_pe_edi_observation"/>
                                        <br/>
                                    </div>
                                </div>
                            </div>


                            <br/>

                            <t t-set="qr_url" t-value="doc._l10n_pe_edi_get_qr()"/>
                            <div t-if="qr_url" class="barcode col-3">
                                <img alt="Barcode" t-att-src="'/report/barcode/?barcode_type=QR&amp;value=%s&amp;width=180&amp;height=180' % quote_plus(qr_url)"/>
                            </div>

                        </div>

                        <div class="col-8" style="margin-left: 10px;">

                            <div t-if="doc.l10n_pe_edi_related_document_type" class="table table-sm o_main_table cpe-tabla" style="border: 1px solid #ddd !important; border-radius: 6px; width: 60%; margin: 0;">

                                <div class="row" style="border-spacing: 0px;">
                                    <div class="col-12 text-center">
                                        Comprobante de Pago
                                    </div>
                                </div>

                                <!--<div style="height: 3px; width: 100%"/>-->
                                
                                <div class="row" style="border-spacing: 0px;">
                                    <div class="col-7">
                                        Tipo de Comprobante
                                    </div>
                                    <div class="col-5">
                                        <span t-field="doc.l10n_pe_edi_related_document_type"/>
                                    </div>
                                </div>

                                <!--<div style="height: 3px; width: 100%"/>-->

                                <div class="row" style="border-spacing: 0px;">
                                    <div class="col-7">
                                        Número de Comprobante
                                    </div>
                                    <div class="col-5">
                                        <span t-field="doc.l10n_pe_edi_document_number"/>
                                    </div>
                                </div>
                                        
                                    <!--<div style="height: 3px; width: 100%" />
                                    <div class="row" style="border-spacing: 0px;">
                                        <div class="col-7">
                                            Fecha de Comprobante
                                        </div>
                                        <div class="col-5">
                                            <span t-field="move.invoice_date"/>
                                        </div>
                                    </div>-->

                            </div>
                            <div style="height: 6px; width: 100%" />
                            <div class="table table-sm o_main_table cpe-tabla" style="border: 1px solid #ddd !important; border-radius: 6px; width: 60%; margin: 0;">
                                <div t-if="doc.sale_id" class="row" style="border-spacing: 0px;">
                                    <div class="col-7">
                                        Doc. de Referencia: 
                                    </div>
                                    <div class="col-5">
                                        <span t-field="doc.sale_id.name"/>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

                </div>
            </div>
            
            <!-- Footer -->
            <div class="footer" >
                <br/>
                <div class="text-center" style="border-top: 1px solid black;">
                    <ul class="list-inline mb4">
                        <li t-if="company.phone">Telefono: 
                            <span t-field="company.phone"/></li>
                        <li t-if="company.email">Email: 
                            <span t-field="company.email"/></li>
                        <li t-if="company.website">
                            Este documento es una representación impresa de la Guía de Remisión. Favor de consultarlo en www.sunat.gob.pe</li>
                    </ul>
                    <div name="financial_infos">
                        <span t-field="company.report_footer"/>
                    </div>
                    <div class="text-muted">
                        <span class="page"/>
                        de  
                        <span class="topage"/></div>
                </div>
                
                <br/>
            </div>
        <!--</t>-->
    </template>


    <template id="report_guia_remision_sunat_raw">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-call="l10n_pe_cpe_guia.l10n_pe_edi_guia_remision_remitente_sunat" t-lang="doc.partner_id.lang"/>
            </t>
        </t>
    </template>


    <template id="report_guia_remision_sunat">
        <t t-call="l10n_pe_cpe_guia.report_guia_remision_sunat_raw"/>
    </template>


    <record id="action_report_guia_remision_sunat" model="ir.actions.report">
        <field name="name">Guia Remisión Remitente SUNAT</field>
        <field name="model">stock.picking</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">l10n_pe_cpe_guia.report_guia_remision_sunat</field>
        <field name="report_file">l10n_pe_cpe_guia.report_guia_remision_sunat</field>
        <field name="print_report_name">('Guia Remisión Remitente SUNAT - %s' % (object.l10n_latam_document_number))</field>
        <field name="binding_model_id" ref="stock.model_stock_picking"/>
        <field name="binding_type">report</field>
    </record>


</odoo>