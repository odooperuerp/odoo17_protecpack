<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="sire_purchase_view_form" model="ir.ui.view">
            <field name="name">sire.purchase.form</field>
            <field name="model">sire.purchase</field>
            <field name="inherit_id" ref="sire_base.sire_base_view_form"/>
            <field name="arch" type="xml">


                <xpath expr="//header" position="inside">

                        <button name="generar_libro_no_domiciliados"
                            string="Generar Op. no domiciliadas"
                            invisible="state not in ['propuesta_generada','reemplazo_generado']"
                            type="object"
                            icon="fa-file-text-o"
                            />


                        <button name="action_print_zip_no_domiciliado" 
                            string="Generar ZIP No Domiciliado"
                            type="object"
                            invisible="state not in ['reemplazo_generado','send']"
                            icon="fa-arrow-circle-o-down"
                            />
                        

                </xpath>

                    <!-- ######################################################################## -->

                    <group name="grupo_base" position="replace">

                        <group name="grupo_base" string="Periodo Fiscal">
                            
                            <field name="company_id" options="{'no_create': True, 'no_create_edit':True}" groups="base.group_multi_company"/>

                            <field name="sire_type" readonly="state != 'draft'"/>

                            <label for="fiscal_year"/>
                            <div>
                                <field name="fiscal_year" placeholder="Año" class="oe_inline" required="1" readonly="state != 'draft'"/>
                                <field name="fiscal_month" placeholder="Mes" class="oe_inline" required="1" readonly="state != 'draft'"/>
                            </div>

                            <!-- ##################################### -->
                            <field name="is_rango_dias" readonly="state != 'draft'"/>

                            <field name="fecha_inicio" invisible="is_rango_dias != True" readonly="state != 'draft'"/>
                            <field name="fecha_fin" invisible="is_rango_dias != True" readonly="state != 'draft'"/>

                            <!-- ##################################### -->
                            
                            <field name="name_archivo_reemplazo_domiciliado_zip" invisible="1"/>
                            <field name="name_archivo_no_domiciliado_zip" invisible="1"/>

                            <field name="file_zip_reemplazo" filename="name_archivo_reemplazo_domiciliado_zip" readonly="1" invisible = "state not in ['reemplazo_generado','send'] or not(file_zip_reemplazo)"/>

                            <field name="file_zip_no_domiciliados" filename="name_archivo_no_domiciliado_zip" readonly="1" invisible = "state not in ['reemplazo_generado','send'] or not(file_zip_reemplazo)"/>

                        </group>


                        <group  name="grupo_filtros_dinamicos" string="Filtros Dinámicos" invisible="state not in ['propuesta_generada','reemplazo_generado']">

                                <label for="partner_ids"/>
                                <div>
                                    <field name="partner_option" placeholder="" class="oe_inline" readonly="state not in ['propuesta_generada','reemplazo_generado']"/>
                                    <field name="partner_ids" placeholder="" class="oe_inline" widget="many2many_tags" options="{'no_create': True}" readonly="state not in ['propuesta_generada','reemplazo_generado']"/>
                                </div>
                        

                                <label for="journal_ids"/>
                                <div>
                                    <field name="journal_option" placeholder="" class="oe_inline" readonly="state not in ['propuesta_generada','reemplazo_generado']"/>
                                    <field name="journal_ids" placeholder="" class="oe_inline" widget="many2many_tags" options="{'no_create': True}" readonly="state not in ['propuesta_generada','reemplazo_generado']"/>
                                </div>

                                <label for="move_ids"/>
                                <div>
                                    <field name="move_option" placeholder="" class="oe_inline" readonly="state not in ['propuesta_generada','reemplazo_generado']"/>
                                    <field name="move_ids" placeholder="" class="oe_inline" widget="many2many_tags" options="{'no_create': True}" readonly="state not in ['propuesta_generada','reemplazo_generado']"/>
                                </div>

                                <label for="currency_ids"/>
                                <div>
                                    <field name="currency_option" placeholder="" class="oe_inline" readonly="state not in ['propuesta_generada','reemplazo_generado']"/>
                                    <field name="currency_ids" placeholder="" class="oe_inline" widget="many2many_tags" options="{'no_create': True}" readonly="state not in ['propuesta_generada','reemplazo_generado']"/>
                                </div>


                        </group>

                        <group>

                            <field name="small_access_token" readonly="1" invisible="state != 'token' or sire_type != 'with_connection_api_sunat'"/>

                            <field name="ticket_propuesta" readonly="1" invisible="state != 'ticket' or sire_type != 'with_connection_api_sunat'"/>

                            <field name="nom_archivo_reporte" readonly="1" invisible="state != 'name_archivos' or sire_type != 'with_connection_api_sunat'"/>

                            <field name="nom_archivo_contenido" readonly="1" invisible="state != 'name_archivos' or sire_type != 'with_connection_api_sunat'"/>


                        </group>

                    </group>

              
                           <xpath expr="//form" position="inside">

                               <notebook>

                                    <page name="sire_compras_propuesta" string="SIRE-COMPRAS PROPUESTA SUNAT" invisible="state not in ['propuesta_generada','reemplazo_generado','send'] or sire_type != 'with_connection_api_sunat'">

                                        <field name="sunat_sire_purchase_line_ids">

                                            <tree create="0">

                                                <field name="ruc"/>
                                                <field name="razon_social"/>
                                                <field name="periodo"/>
                                                <field name="car_sunat"/>
                                                <field name="fecha_emision"/>
                                                <field name="fecha_vencimiento"/>
                                                <field name="tipo_comprobante"/>
                                                <field name="serie_comprobante"/>
                                                <field name="anio_emision_dm"/>
                                                <field name="nro_comprobante_nro_inicial"/>
                                                <field name="nro_final"/>
                                                <field name="tipo_doc_identidad_proveedor"/>
                                                <field name="num_doc_identidad_proveedor"/>
                                                <field name="razon_social_proveedor"/>
                                                <field name="base_imponible_gravada" sum="sum_base_imponible_gravada"/>
                                                <field name="igv" sum="sum_igv"/>
                                                <field name="base_imponible_gravada_dgng" sum="sum_base_imponible_gravada_dgng"/>
                                                <field name="igv_dgng" sum="sum_igv_dgng"/>
                                                <field name="base_imponible_gravada_dng" sum="sum_base_imponible_gravada_dng"/>
                                                <field name="igv_dng" sum="sum_igv_dng"/>
                                                <field name="valor_adquisiciones_ng" sum="sum_valor_adquisiciones_ng"/>
                                                <field name="isc" sum="sum_isc"/>
                                                <field name="icbper" sum="sum_icbper"/>
                                                <field name="otros_tributos" sum="sum_otros_tributos"/>
                                                <field name="total_comprobante" sum="sum_total_comprobante"/>
                                                <field name="codigo_moneda"/>
                                                <field name="tipo_cambio"/>
                                                <field name="fecha_emision_doc_modificado"/>
                                                <field name="tipo_comprobante_modificado"/>
                                                <field name="serie_comprobante_modificado"/>
                                                <field name="cod_dam"/>
                                                <field name="numero_comprobante_modificado"/>
                                                <field name="clasif_bss"/>
                                                <field name="id_proyecto"/>
                                                <field name="porcentaje_participacion"/>
                                                <field name="imb"/>
                                                <field name="car_cp_modificar"/>
                                                <field name="marca_detraccion"/>
                                                <field name="tipo_nota"/>
                                                <field name="estado_comprobante"/>
                                                <field name="inconsistencias"/>

                                            </tree>
                                        </field>

                                    </page>

                                    <page name="sire_compras_reemplazo" string="SIRE-COMPRAS REEMPLAZO" invisible="state not in ['reemplazo_generado','send']">
                                
                                        <field name='sire_purchase_line_ids'>
                                       
                                            <tree create="0">

                                                <field name="invoice_id"/>
                                                <field name="car"/>
                                                <field name="fecha_emision_comprobante"/>
                                                <field name="fecha_vencimiento"/>
                                                <field name="tipo_comprobante"/>
                                                <field name="serie_comprobante"/>
                                                <field name="anio_emision_DUA"/>
                                                <field name="numero_comprobante"/>
                                                <field name="operaciones_sin_igv"/>
                                                <field name="tipo_documento_proveedor"/>
                                                <field name="ruc_dni"/>
                                                <field name="razon_social"/>
                                                <field name="base_imponible_igv_gravadas" sum="sum_base_imponible_igv_gravadas"/>
                                                <field name="monto_igv_1" sum="sum_monto_igv_1"/>
                                                <field name="base_imponible_igv_no_gravadas" sum="sum_base_imponible_igv_no_gravadas"/>
                                                <field name="monto_igv_2" sum="sum_monto_igv_2"/>
                                                <field name="base_imponible_no_igv" sum="sum_base_imponible_no_igv"/>
                                                <field name="monto_igv_3" sum="sum_monto_igv_3"/>
                                                <field name="valor_no_gravadas" sum="sum_valor_no_gravadas"/>
                                                <field name="isc" sum="sum_isc"/>
                                                <field name="impuesto_consumo_bolsas_plastico" sum="sum_impuesto_consumo_bolsas_plastico"/>
                                                <field name="otros_impuestos" sum="sum_otros_impuestos"/>
                                                <field name="importe_adquisiciones_registradas" sum="sum_importe_adquisiciones_registradas"/>
                                                <field name="codigo_moneda"/>
                                                <field name="tipo_cambio"/>
                                                <field name="fecha_emision_original"/>
                                                <field name="tipo_comprobante_original"/>
                                                <field name="serie_comprobante_original"/>
                                                <field name="dua_doc_modificado"/>
                                                <field name="numero_comprobante_original"/>
                                                <field name="clasificacion_bienes"/>
                                                <field name="identificacion_contrato"/>
                                                <field name="participacion_contrato"/>
                                                <field name="imp_mat_beneficio"/>
                                                <field name="indicador_exclusion_inclusion"/>

                                            </tree>             
                                        </field>
                                    </page>


                                    <page name="sire_comparacion_compras" string="COMPARACIÓN" invisible="state not in ['reemplazo_generado','send'] or sire_type != 'with_connection_api_sunat'">
                                
                                        <field name='sire_purchase_compare_line_ids'>
                                       
                                            <tree create="0" decoration-info="estado_compare == '0'" decoration-danger="estado_compare == '1'">

                                                <field name="fecha_emision"/>
                                                <field name="tipo_documento_cp"/>
                                                <field name="serie_documento_cp"/>
                                                <field name="numero_documento_cp"/>
                                                <field name="nro_doc_identidad_proveedor"/>
                                                <field name="razon_social"/>
                                                <field name="total_cp"/>
                                                <field name="moneda"/>
                                                <field name="estado_compare"/>

                                            </tree>             
                                        </field>
                                    </page>


                                    <page name="sire_compras_no_domiciliados" string="SIRE-COMPRAS NO DOMICILIADAS" invisible="state not in ['reemplazo_generado','send']">
                                
                                        <field name='sire_purchase_no_domiciliados_line_ids'>
                                       
                                            <tree create="0">

                                                <field name="invoice_id"/>
                                                <field name="partner_id"/>
                                                <field name="currency_id"/>
                                                <field name="fecha_emision_comprobante"/>
                                                <field name="tipo_comprobante"/>
                                                <field name="serie_comprobante"/>
                                                <field name="numero_comprobante"/>
                                                <field name="valor_adquisiciones"/>
                                                <field name="otros_conceptos_adicionales"/>
                                                <field name="importe_total"/>
                                                <field name="tipo_comprobante_credito_fiscal"/>
                                                <field name="serie_comprobante_credito_fiscal"/>
                                                <field name="anio_emision_DUA"/>
                                                <field name="numero_comprobante_pago_impuesto"/>
                                                <field name="retencion_igv"/>
                                                <field name="codigo_moneda"/>
                                                <field name="tipo_cambio"/>
                                                <field name="pais_residencia"/>
                                                <field name="razon_social"/>
                                                <field name="domicilio_extranjero"/>
                                                <field name="numero_identificacion"/>
                                                <field name="identificacion_beneficiario"/>
                                                <field name="razon_social_beneficiario"/>
                                                <field name="pais_beneficiario"/>
                                                <field name="vinculo_sujeto_beneficiario"/>
                                                <field name="renta_bruta"/>
                                                <field name="deduccion_costo_capital"/>
                                                <field name="renta_neta"/>
                                                <field name="tasa_retencion"/>
                                                <field name="impuesto_retenido"/>
                                                <field name="convenios_evitar_doble_imposicion"/>
                                                <field name="exoneracion_aplicada"/>
                                                <field name="tipo_renta"/>
                                                <field name="modalidad_servicio_sujeto"/>
                                                <field name="aplicacion_ley_impuesto_renta"/>
                                                <field name="car"/>

                                            </tree>             
                                        </field>
                                    </page>



                                    <page name="respuesta_conexion_sunat_compras" string="RESPUESTA DE PETICIÓN A SUNAT" invisible="state in ['draft','token','ticket','name_archivos'] or sire_type != 'with_connection_api_sunat'">

                                        <group>

                                            <group string="Ticket y Datos de Archivo obtenidos">

                                                <field name="ticket_propuesta" readonly="1"/>
                                                <field name="nom_archivo_reporte" readonly="1"/>
                                                <field name="nom_archivo_contenido" readonly="1"/>
                
                                            </group>

                                            <group string="Token Generado">

                                                <field name="access_token" readonly="1"/>

                                            </group>

                                        </group>

                                    </page>

                                </notebook>
                    </xpath>                            
            </field>
        </record>


        <!-- #END RECORD  -->
        <record id="sire_purchase_view_tree" model="ir.ui.view">
            <field name="name">sire.purchase.tree</field>
            <field name="model">sire.purchase</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="fiscal_year"/>
                    <field name="fiscal_month"/>
                    <field name="company_id"/>
                    
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <record id="action_sire_purchase" model="ir.actions.act_window">
            <field name="name">SIRE-RCE</field>
            <field name="res_model">sire.purchase</field>
            <field name="view_mode">tree,form</field>
            <field eval="False" name="view_id"/>
            <field name="domain">[('company_id','=',allowed_company_ids[0])]</field>
            <field name="help" type="html">
              <p class="o_view_nocontent_smiling_face">
                Crear libro de compras SIRE-COMPRAS
              </p><p>
                El libro de compras es un documento tributario
                y su representacion es en los siguientes formatos: txt y excel.
              </p>
            </field>
        </record>


        <record id="action_pe_purchase_tree" model="ir.actions.act_window.view">
            <field eval="1" name="sequence"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="sire_purchase_view_tree"/>
            <field name="act_window_id" ref="action_sire_purchase"/>
        </record>

        <record id="action_pe_purchase_form" model="ir.actions.act_window.view">
            <field eval="2" name="sequence"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="sire_purchase_view_form"/>
            <field name="act_window_id" ref="action_sire_purchase"/>
        </record>

         <menuitem id="menu_sire_purchase" parent="sire_base.menu_registro" sequence="1" action="action_sire_purchase"/>
    </data>
</odoo>