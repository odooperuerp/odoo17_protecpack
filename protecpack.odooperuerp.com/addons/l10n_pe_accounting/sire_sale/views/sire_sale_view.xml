<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="sire_sale_view_form" model="ir.ui.view">
            <field name="name">sire.sale.form</field>
            <field name="model">sire.sale</field>
            <field name="inherit_id" ref="sire_base.sire_base_view_form"/>
            <field name="arch" type="xml">


                    <group name="grupo_base" position="replace">

                        <group name="grupo_base" string="Periodo Fiscal">
                            
                            <field name="company_id" options="{'no_create': True, 'no_create_edit':True}" groups="base.group_multi_company"/>

                            <field name="sire_type" readonly="state != 'draft'"/>


                            <label for="fiscal_year"/>
                            <div>
                                <field name="fiscal_year" placeholder="Año" class="oe_inline" required="1" readonly="state != 'draft'"/>
                                <field name="fiscal_month" placeholder="Mes" class="oe_inline" required="1" readonly="state != 'draft'"/>
                            </div>


                            <field name="is_rango_dias" readonly="state != 'draft'"/>

                            <field name="fecha_inicio" invisible="is_rango_dias != True" readonly="state != 'draft'"/>
                            <field name="fecha_fin" invisible="is_rango_dias != True" readonly="state != 'draft'"/>


                            <field name="name_archivo_reemplazo_zip" invisible="1"/>

                            <field name="file_zip_reemplazo" readonly="1" invisible="state not in ['reemplazo_generado','send'] or not(file_zip_reemplazo)" filename="name_archivo_reemplazo_zip"/>


                        </group>


                        <group  name="grupo_filtros_dinamicos" string="Filtros Dinámicos" invisible = "state not in ['propuesta_generada','reemplazo_generado']">


                                <label for="partner_ids"/>
                                <div>
                                    <field name="partner_option" placeholder="" class="oe_inline" readonly="state not in ['propuesta_generada','reemplazo_generado']"/>
                                    <field name="partner_ids" placeholder="" class="oe_inline" widget="many2many_tags" options="{'no_create': True}" readonly="state not in ['propuesta_generada','reemplazo_generado']"/>
                                </div>
                        

                                <label for="journal_ids"/>
                                <div>
                                    <field name="journal_option" placeholder="" class="oe_inline" readonly="state not in ['propuesta_generada','reemplazo_generado']"/>
                                    <field name="journal_ids" placeholder="" class="oe_inline" widget="many2many_tags" options="{'no_create': True}" readonly="state not in ['propuesta_generada','reemplazo_generado']"/>
                                </div>

                                <label for="move_ids"/>
                                <div>
                                    <field name="move_option" placeholder="" class="oe_inline" readonly="state not in ['propuesta_generada','reemplazo_generado']"/>
                                    <field name="move_ids" placeholder="" class="oe_inline" widget="many2many_tags" options="{'no_create': True}" readonly="state not in ['propuesta_generada','reemplazo_generado']"/>
                                </div>

                                <label for="currency_ids"/>
                                <div>
                                    <field name="currency_option" placeholder="" class="oe_inline" readonly="state not in ['propuesta_generada','reemplazo_generado']"/>
                                    <field name="currency_ids" placeholder="" class="oe_inline" widget="many2many_tags" options="{'no_create': True}" readonly="state not in ['propuesta_generada','reemplazo_generado']"/>
                                </div>

                        </group>

                        <group>


                            <field name="small_access_token" readonly="1" invisible = "state != 'token' or sire_type != 'with_connection_api_sunat'" widget="text" options="{'maxlength': 150}"/>

                            <field name="ticket_propuesta" readonly="1" invisible = "state != 'ticket' or sire_type != 'with_connection_api_sunat'"/>

                            <field name="nom_archivo_reporte" readonly="1" invisible = "state != 'name_archivos' or sire_type != 'with_connection_api_sunat'"/>

                            <field name="nom_archivo_contenido" readonly="1" invisible = "state != 'name_archivos' or sire_type != 'with_connection_api_sunat'"/>

                        </group>
                    </group>

              

                           <xpath expr="//form" position="inside">

                               <notebook>

                                    <page name="sire-Ventas-propuesta" string="SIRE-VENTAS PROPUESTA SUNAT" invisible ="state not in ['propuesta_generada','reemplazo_generado','send'] or sire_type != 'with_connection_api_sunat'">

                                        <field name="sunat_sire_sale_line_ids">

                                            <tree create="0">

                                                <field name="ruc"/>
                                                <field name="razon_social"/>
                                                <field name="periodo"/>
                                                <field name="car_sunat"/>
                                                <field name="fecha_emision"/>
                                                <field name="fecha_vencimiento"/>
                                                <field name="tipo_documento_cp"/>
                                                <field name="serie_documento_cp"/>
                                                <field name="numero_documento_cp"/>
                                                <field name="nro_final_rango"/>
                                                <field name="tipo_doc_cliente"/>
                                                <field name="nro_doc_identidad_cliente"/>
                                                <field name="razon_social"/>
                                                <field name="valor_fcturado_exportacion" sum="sum_valor_fcturado_exportacion"/>
                                                <field name="base_imponible_grabada" sum="sum_base_imponible_grabada"/>
                                                <field name="descuento_base_imponible" sum="sum_descuento_base_imponible"/>
                                                <field name="igv" sum="sum_igv"/>
                                                <field name="descuento_igv" sum="sum_descuento_igv"/>
                                                <field name="monto_exonerado" sum="sum_monto_exonerado"/>
                                                <field name="monto_inafecto" sum="sum_monto_inafecto"/>
                                                <field name="isc" sum="sum_isc"/>
                                                <field name="base_imponible_ivap" sum="sum_base_imponible_ivap"/>
                                                <field name="ivap" sum="sum_ivap"/>
                                                <field name="icbper" sum="sum_icbper"/>
                                                <field name="otros_tributos" sum="sum_otros_tributos"/>
                                                <field name="total_cp" sum="sum_total_cp"/>
                                                <field name="moneda" sum="sum_moneda"/>
                                                <field name="tipo_cambio"/>
                                                <field name="fecha_emision_doc_modificado"/>
                                                <field name="tipo_cp_modificado"/>
                                                <field name="serie_cp_modificado"/>
                                                <field name="nro_cp_modificado"/>
                                                <field name="id_proyecto_operadores_atribucion"/>
                                                <field name="tipo_nota"/>
                                                <field name="estado_comprobante"/>
                                                <field name="valor_fob_embarcado"/>
                                                <field name="valor_op_gratuitas"/>
                                                <field name="tipo_operacion"/>
                                                <field name="dam_cp"/>
                                                <field name="clu"/>

                                            </tree>
                                        </field>

                                    </page>

                                    <page name="sire-Ventas" string="SIRE-VENTAS REEMPLAZO" invisible = "state not in ['reemplazo_generado','send']">
                                
                                        <field name='sire_sale_line_ids'>
                                       
                                            <tree create="0">

                                                <field name ="invoice_id" />
                                                <field name="sire_sale_id"  invisible="1" />
                                                <field name="invoice_id_2" invisible="1" />
                                                <field name ="fecha_emision_comprobante" />
                                                <field name ="fecha_vencimiento" />
                                                <field name ="tipo_comprobante" />
                                                <field name ="serie_comprobante" />
                                                <field name ="numero_comprobante" />
                                                <field name ="tipo_documento_cliente" />
                                                <field name ="numero_documento_cliente" />
                                                <field name ="razon_social" />
                                                <field name ="ventas_valor_facturado_exportacion" sum="sum_ventas_valor_facturado_exportacion"/>
                                                <field name ="ventas_base_imponible_operacion_gravada" sum="sum_ventas_base_imponible_operacion_gravada"/>
                                                <field name ="ventas_descuento_base_imponible" sum="sum_ventas_descuento_base_imponible"/>
                                                <field name ="ventas_igv" sum="sum_ventas_igv"/>
                                                <field name ="ventas_descuento_igv" sum="sum_ventas_descuento_igv"/>
                                                <field name ="ventas_importe_operacion_exonerada" sum="sum_ventas_importe_operacion_exonerada"/>
                                                <field name ="ventas_importe_operacion_inafecta" sum="sum_ventas_importe_operacion_inafecta"/>
                                                <field name ="isc" sum="sum_isc"/>
                                                <field name ="ventas_base_imponible_arroz_pilado" sum="sum_ventas_base_imponible_arroz_pilado"/>
                                                <field name ="ventas_impuesto_arroz_pilado" sum="sum_ventas_impuesto_arroz_pilado"/>
                                                <field name ="impuesto_consumo_bolsas_plastico" sum="sum_impuesto_consumo_bolsas_plastico"/>
                                                <field name ="otros_impuestos" sum="sum_otros_impuestos"/>
                                                <field name ="importe_total_comprobante" sum="sum_importe_total_comprobante"/>
                                                <field name ="codigo_moneda" />
                                                <field name ="tipo_cambio" />
                                                <field name ="fecha_emision_original" />
                                                <field name ="tipo_comprobante_original" />
                                                <field name ="serie_comprobante_original" />
                                                <field name ="numero_comprobante_original" />
                                                <field name ="ventas_identificacion_contrato_operadores" />
                                                <field name ="error_1" />
                                                <field name ="ventas_indicador_comprobantes_medios_pago" />

                                            </tree>             
                                        </field>
                                    </page>


                                    <page name="sire_comparacion" string="COMPARACIÓN" invisible = "state not in ['reemplazo_generado','send'] or sire_type != 'with_connection_api_sunat'">
                                
                                        <field name='sire_sale_compare_line_ids'>

                                            <tree create="0" decoration-info="estado_compare == '0'" decoration-danger="estado_compare == '1'">


                                                <field name="fecha_emision"/>
                                                <field name="tipo_documento_cp"/>
                                                <field name="serie_documento_cp"/>
                                                <field name="numero_documento_cp"/>
                                                <field name="nro_doc_identidad_cliente"/>
                                                <field name="razon_social"/>
                                                <field name="total_cp"/>
                                                <field name="moneda"/>
                                                <field name="estado_compare"/>

                                            </tree>             
                                        </field>
                                    </page>


                                    <page name="respuesta_conexion_sunat" string="RESPUESTA DE PETICIÓN A SUNAT" invisible = "state in ['draft','token','ticket','name_archivos'] or sire_type != 'with_connection_api_sunat'">

                                        <group>

                                            <group string="Ticket y Datos de Archivo obtenidos">

                                                <field name="ticket_propuesta" readonly="1"/>
                                                <field name="nom_archivo_reporte" readonly="1"/>
                                                <field name="nom_archivo_contenido" readonly="1"/>
                
                                            </group>

                                            <group string="Token Generado">

                                                <field name="access_token" readonly="1" widget="text" options="{'maxlength': 150}"/>

                                            </group>

                                        </group>

                                    </page>

                                </notebook>
                    </xpath>                            
            </field>
        </record>


        <!-- #END RECORD  -->
        <record id="sire_sale_view_tree" model="ir.ui.view">
            <field name="name">sire.sale.tree</field>
            <field name="model">sire.sale</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="fiscal_year"/>
                    <field name="fiscal_month"/>
                    <field name="company_id"/>
                    
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <record id="action_sire_sale" model="ir.actions.act_window">
            <field name="name">SIRE-RVIE</field>
            <field name="res_model">sire.sale</field>
            <field name="view_mode">tree,form</field>
            <field eval="False" name="view_id"/>
            <field name="domain">[('company_id','=',allowed_company_ids[0])]</field>
            <field name="help" type="html">
              <p class="o_view_nocontent_smiling_face">
                Crear libro de ventas SIRE-VENTAS
              </p><p>
                El libro de ventas es un documento tributario
                y su representacion es en los siguientes formatos , txt y excel.
              </p>
            </field>
        </record>


        <record id="action_pe_sale_tree" model="ir.actions.act_window.view">
            <field eval="1" name="sequence"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="sire_sale_view_tree"/>
            <field name="act_window_id" ref="action_sire_sale"/>
        </record>

        <record id="action_pe_sale_form" model="ir.actions.act_window.view">
            <field eval="2" name="sequence"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="sire_sale_view_form"/>
            <field name="act_window_id" ref="action_sire_sale"/>
        </record>

         <menuitem id="menu_sire_sale" parent="sire_base.menu_registro" sequence="0" action="action_sire_sale"/>
    </data>
</odoo>